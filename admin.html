<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Key | ‡πÑ‡∏ó‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</title>
    <meta name="description" content="‡∏´‡∏ô‡πâ‡∏≤ Admin ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Key">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=5">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">

    <style>
        .admin-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .login-card,
        .admin-panel {
            background: var(--color-bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--color-border);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
        }

        .login-card h1,
        .admin-panel h1 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--color-text-primary);
        }

        .login-card .icon-large {
            font-size: 4rem;
            text-align: center;
            display: block;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);
        }

        .btn-block {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--color-error);
            color: var(--color-error);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--color-success);
            color: var(--color-success);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .status-card {
            background: var(--color-bg-tertiary);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--color-border);
        }

        .status-card .status-label {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.25rem;
        }

        .status-card .status-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .status-card .status-value.expired {
            color: var(--color-error);
        }

        .status-card .status-value.active {
            color: var(--color-success);
        }

        .forgot-password {
            text-align: center;
            margin-top: 1rem;
        }

        .forgot-password a {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .admin-header h1 {
            margin: 0;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--color-text-secondary);
            text-decoration: none;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--color-primary);
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-top: 0.5rem;
        }

        .divider {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: 1.5rem 0;
        }

        .password-toggle {
            position: relative;
        }

        .password-toggle input {
            padding-right: 3rem;
        }

        .password-toggle button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.5rem;
        }

        .recovery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .recovery-modal.active {
            display: flex;
        }

        .recovery-content {
            background: var(--color-bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .recovery-content h2 {
            margin-bottom: 1rem;
        }

        .recovery-content p {
            color: var(--color-text-secondary);
            margin-bottom: 1.5rem;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">üîê</div>
                    <div class="logo-text">
                        <h1>Admin Panel</h1>
                        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Key</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="admin-container">
            <a href="index.html" class="back-link">
                <span>‚Üê</span>
                <span>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </a>

            <!-- Login Form -->
            <div id="loginCard" class="login-card">
                <span class="icon-large">üîí</span>
                <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</h1>

                <div id="loginError" class="error-message"></div>

                <form id="loginForm">
                    <div class="form-group">
                        <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin</label>
                        <div class="password-toggle">
                            <input type="password" id="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                            <button type="button" id="togglePassword">üëÅÔ∏è</button>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <span class="icon">üîì</span>
                        <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </button>
                </form>

                <div class="forgot-password">
                    <a href="#" id="forgotPasswordBtn">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
                </div>
            </div>

            <!-- Admin Panel (Hidden by default) -->
            <div id="adminPanel" class="admin-panel hidden">
                <div class="admin-header">
                    <h1>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Key</h1>
                    <button id="logoutBtn" class="btn btn-ghost">
                        <span class="icon">üö™</span>
                        <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </button>
                </div>

                <div id="successMessage" class="success-message"></div>
                <div id="errorMessage" class="error-message"></div>

                <!-- Current Status -->
                <div class="status-card">
                    <div class="status-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ API Key</div>
                    <div id="apiStatus" class="status-value">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
                </div>

                <div class="status-card">
                    <div class="status-label">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏°‡∏∑‡πà‡∏≠</div>
                    <div id="expiryTime" class="status-value">-</div>
                </div>

                <hr class="divider">

                <form id="apiKeyForm">
                    <!-- Active Provider Selection -->
                    <div class="form-group">
                        <label>üéØ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Provider</label>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button type="button" class="provider-btn active" data-provider="groq"
                                style="flex: 1; padding: 0.75rem; border-radius: 8px; border: 2px solid var(--color-primary); background: rgba(var(--color-primary-rgb), 0.1); color: var(--color-primary); cursor: pointer; font-weight: 600;">
                                ‚ö° Groq
                            </button>
                            <button type="button" class="provider-btn" data-provider="gemini"
                                style="flex: 1; padding: 0.75rem; border-radius: 8px; border: 2px solid var(--color-border); background: var(--color-bg-tertiary); color: var(--color-text-secondary); cursor: pointer; font-weight: 600;">
                                üåü Gemini
                            </button>
                        </div>
                        <p class="help-text">üí° ‡∏ñ‡πâ‡∏≤ Provider ‡∏´‡∏•‡∏±‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                    </div>

                    <hr class="divider">

                    <!-- Groq API Key -->
                    <div class="form-group">
                        <label for="groqApiKey">‚ö° Groq API Key</label>
                        <textarea id="groqApiKey" rows="3"
                            placeholder="‡πÉ‡∏™‡πà Groq API Keys (‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß)&#10;gsk_...&#10;gsk_..."></textarea>
                        <p class="help-text">
                            ‚ú® ‡∏£‡∏±‡∏ö Groq API Key ‡∏ü‡∏£‡∏µ: <a href="https://console.groq.com/keys"
                                target="_blank">console.groq.com/keys</a>
                        </p>
                    </div>

                    <!-- Gemini API Key -->
                    <div class="form-group">
                        <label for="geminiApiKey">üåü Google Gemini API Key</label>
                        <textarea id="geminiApiKey" rows="3"
                            placeholder="‡πÉ‡∏™‡πà Gemini API Keys (‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß)&#10;AIza...&#10;AIza..."></textarea>
                        <p class="help-text">
                            ‚ú® ‡∏£‡∏±‡∏ö Gemini API Key ‡∏ü‡∏£‡∏µ: <a href="https://aistudio.google.com/app/apikey"
                                target="_blank">aistudio.google.com</a>
                        </p>
                    </div>

                    <hr class="divider">

                    <div class="form-group">
                        <label for="expiryHours">‚è∞ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</label>
                        <select id="expiryHours">
                            <option value="1">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                            <option value="4">4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                            <option value="8">8 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                            <option value="10" selected>10 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)</option>
                            <option value="24">24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (1 ‡∏ß‡∏±‡∏ô)</option>
                            <option value="72">72 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (3 ‡∏ß‡∏±‡∏ô)</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <span class="icon">üíæ</span>
                        <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API Keys</span>
                    </button>
                </form>

                <hr class="divider">

                <button id="clearApiKeyBtn" class="btn btn-ghost btn-block" style="color: var(--color-error);">
                    <span class="icon">üóëÔ∏è</span>
                    <span>‡∏•‡πâ‡∏≤‡∏á API Key</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Recovery Modal -->
    <div id="recoveryModal" class="recovery-modal">
        <div class="recovery-content">
            <h2>üîë ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
            <p id="recoveryMessage">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà Email...</p>
            <button id="closeRecoveryBtn" class="btn btn-primary">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Scripts -->
    <script type="module">
        import adminService from './admin-service.js?v=5';

        class AdminPage {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkLoginStatus();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // Toggle password visibility
                document.getElementById('togglePassword').addEventListener('click', () => {
                    const input = document.getElementById('password');
                    input.type = input.type === 'password' ? 'text' : 'password';
                });

                // Forgot password
                document.getElementById('forgotPasswordBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.handleForgotPassword();
                });

                // Close recovery modal
                document.getElementById('closeRecoveryBtn').addEventListener('click', () => {
                    document.getElementById('recoveryModal').classList.remove('active');
                });

                // Logout
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.handleLogout();
                });

                // API Key form
                document.getElementById('apiKeyForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSaveApiKey();
                });

                // Clear API Key
                document.getElementById('clearApiKeyBtn').addEventListener('click', () => {
                    if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á API Key ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                        localStorage.removeItem('groq_api_key');
                        localStorage.removeItem('gemini_api_key');
                        localStorage.removeItem('admin_api_expiry');
                        document.getElementById('groqApiKey').value = '';
                        document.getElementById('geminiApiKey').value = '';
                        this.updateStatus();
                        this.showSuccess('‡∏•‡πâ‡∏≤‡∏á API Key ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                    }
                });

                // Provider button clicks
                document.querySelectorAll('.provider-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const provider = btn.dataset.provider;
                        adminService.setProvider(provider);
                        this.updateProviderButtons(provider);
                        this.updateStatus();
                        this.showSuccess(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${provider === 'groq' ? 'Groq' : 'Gemini'} ‡πÅ‡∏•‡πâ‡∏ß`);
                    });
                });
            }

            checkLoginStatus() {
                if (adminService.isLoggedIn()) {
                    this.showAdminPanel();
                } else {
                    this.showLoginForm();
                }
            }

            handleLogin() {
                const password = document.getElementById('password').value;
                const errorDiv = document.getElementById('loginError');

                if (adminService.login(password)) {
                    errorDiv.style.display = 'none';
                    this.showAdminPanel();
                } else {
                    errorDiv.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                    errorDiv.style.display = 'block';
                }
            }

            handleLogout() {
                adminService.logout();
                this.showLoginForm();
            }

            async handleForgotPassword() {
                const modal = document.getElementById('recoveryModal');
                const message = document.getElementById('recoveryMessage');

                modal.classList.add('active');
                message.textContent = 'üìß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô...';

                const result = await adminService.sendRecoveryEmail();

                if (result.manualRecovery) {
                    message.innerHTML = `
            <strong>‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS</strong><br><br>
            ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin ‡∏Ñ‡∏∑‡∏≠: <code style="background: #333; padding: 0.25rem 0.5rem; border-radius: 4px;">Weerachit@jay</code><br><br>
            <small>‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏á Email ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</small>
          `;
                } else if (result.success) {
                    message.textContent = `‚úÖ ${result.message}`;
                } else {
                    message.textContent = `‚ùå ${result.message}`;
                }
            }

            handleSaveApiKey() {
                const groqApiKey = document.getElementById('groqApiKey').value.trim();
                const geminiApiKey = document.getElementById('geminiApiKey').value.trim();
                const expiryHours = parseInt(document.getElementById('expiryHours').value);

                if (!groqApiKey && !geminiApiKey) {
                    this.showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å API Key ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Provider');
                    return;
                }

                // Save both API keys
                let totalKeys = 0;

                if (groqApiKey) {
                    const groqKeys = groqApiKey.split('\n').map(k => k.trim()).filter(k => k.length > 0);
                    localStorage.setItem('groq_api_key', JSON.stringify(groqKeys));
                    localStorage.setItem('groq_key_index', '0');
                    totalKeys += groqKeys.length;
                }

                if (geminiApiKey) {
                    const geminiKeys = geminiApiKey.split('\n').map(k => k.trim()).filter(k => k.length > 0);
                    localStorage.setItem('gemini_api_key', JSON.stringify(geminiKeys));
                    localStorage.setItem('gemini_key_index', '0');
                    totalKeys += geminiKeys.length;
                }

                // Set expiry time
                const expiryTime = Date.now() + (expiryHours * 60 * 60 * 1000);
                localStorage.setItem('admin_api_expiry', expiryTime.toString());

                this.showSuccess(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API Keys ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (${totalKeys} keys, ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô ${expiryHours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)`);
                this.updateStatus();
            }

            showLoginForm() {
                document.getElementById('loginCard').classList.remove('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('password').value = '';
            }

            showAdminPanel() {
                document.getElementById('loginCard').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');

                // Load current provider
                const currentProvider = adminService.getProvider();
                this.updateProviderButtons(currentProvider);

                // Load current API keys for both providers
                const groqKeys = JSON.parse(localStorage.getItem('groq_api_key') || '[]');
                const geminiKeys = JSON.parse(localStorage.getItem('gemini_api_key') || '[]');

                document.getElementById('groqApiKey').value = groqKeys.join('\n');
                document.getElementById('geminiApiKey').value = geminiKeys.join('\n');

                this.updateStatus();
            }

            updateProviderButtons(activeProvider) {
                document.querySelectorAll('.provider-btn').forEach(btn => {
                    if (btn.dataset.provider === activeProvider) {
                        btn.classList.add('active');
                        btn.style.border = '2px solid var(--color-primary)';
                        btn.style.background = 'rgba(var(--color-primary-rgb), 0.1)';
                        btn.style.color = 'var(--color-primary)';
                    } else {
                        btn.classList.remove('active');
                        btn.style.border = '2px solid var(--color-border)';
                        btn.style.background = 'var(--color-bg-tertiary)';
                        btn.style.color = 'var(--color-text-secondary)';
                    }
                });
            }

            updateStatus() {
                const statusDiv = document.getElementById('apiStatus');
                const expiryDiv = document.getElementById('expiryTime');

                const timeRemaining = adminService.getTimeRemaining();
                const currentProvider = adminService.getProvider();

                // Count keys for both providers
                const groqKeys = JSON.parse(localStorage.getItem('groq_api_key') || '[]');
                const geminiKeys = JSON.parse(localStorage.getItem('gemini_api_key') || '[]');
                const totalKeys = groqKeys.length + geminiKeys.length;

                // Check expiry
                const expiryTime = parseInt(localStorage.getItem('admin_api_expiry') || '0');
                const isExpired = expiryTime > 0 && Date.now() > expiryTime;

                if (isExpired) {
                    statusDiv.textContent = '‚ùå ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß';
                    statusDiv.className = 'status-value expired';
                    expiryDiv.textContent = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß';
                } else if (totalKeys === 0) {
                    statusDiv.textContent = '‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤';
                    statusDiv.className = 'status-value';
                    expiryDiv.textContent = '-';
                } else {
                    let statusText = `‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | `;
                    if (groqKeys.length > 0) statusText += `Groq: ${groqKeys.length}`;
                    if (groqKeys.length > 0 && geminiKeys.length > 0) statusText += ` | `;
                    if (geminiKeys.length > 0) statusText += `Gemini: ${geminiKeys.length}`;
                    statusText += ` | üéØ ${currentProvider === 'groq' ? 'Groq' : 'Gemini'}`;

                    statusDiv.textContent = statusText;
                    statusDiv.className = 'status-value active';
                    expiryDiv.textContent = timeRemaining.message;
                }
            }

            showSuccess(message) {
                const div = document.getElementById('successMessage');
                div.textContent = '‚úÖ ' + message;
                div.style.display = 'block';
                setTimeout(() => div.style.display = 'none', 3000);
            }

            showError(message) {
                const div = document.getElementById('errorMessage');
                div.textContent = '‚ùå ' + message;
                div.style.display = 'block';
                setTimeout(() => div.style.display = 'none', 3000);
            }
        }

        // Initialize
        new AdminPage();
    </script>
</body>

</html>